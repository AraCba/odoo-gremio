<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Vista de lista -->
    <record model="ir.ui.view" id="solicitudes_tree_view">
        <field name="name">Solicitudes</field>
        <field name="model">docentes.solicitudes</field>
        <field name="arch" type="xml">
            <tree string="Solicitudes">
                <field name="docente"/>
                <!-- <field name="docente_bis"/> -->
                <field name="state"/>
                <field name="tipo_solicitud"/>
                <field name="fecha_sol"/>
                <field name="fecha_ult_estado"/>
                <field name="doc_completa"/>
            </tree>
        </field>
    </record>

    <!-- Vista de formulario -->
    <record model="ir.ui.view" id="solicitudes_form_view">
        <field name="name">Solicitudes</field>
        <field name="model">docentes.solicitudes</field>
        <field name="arch" type="xml">
            <form string="Solicitudes">
                <header>
                    <button name="autorizar" type="object" states="sol" string="Autorizar" class="oe_highlight"/>
                    <button name="rechazar" type="object" states="sol" string="Rechazar"/>
                    <button name="finalizar" type="object" states="aut" string="Finalizar" class="oe_highlight"/>
                    <button name="cancelar" type="object" states="sol,aut,fin" string="Cancelar" />
                    <field name="state" widget="statusbar" statusbar_visible="sol,aut,rec,fin,can" />
                </header>

                <sheet>
                    <group col="2">
                        <group>
                            <field name="mostrar_bolsones" invisible="1" />
                            <field name="mostrar_subsidios" invisible="1" />
                            <field name="mostrar_prestamos" invisible="1" />
                            <field name="mostrar_notas" invisible="1" />
                            <field name="tipo_solicitud" attrs="{'readonly': [('state', 'not in', ['nue','sol'])]}" domain="[('activo','=',True)]"/>
                            <field name="docente" attrs="{'readonly': [('state', 'not in', ['nue','sol'])]}"/>   
                            <!-- <field name="docente_bis" attrs="{'readonly': [('state', 'not in', ['nue','sol'])]}"/>                               -->
                            <field name="doc_completa" attrs="{'readonly': [('state', 'not in', ['nue','sol','aut'])]}"/>
                            <field name="expediente_resolucion" attrs="{'readonly': [('state', 'not in', ['nue','sol'])]}"/>
                            <!-- <field name="resolucion" attrs="{'readonly': [('state', 'not in', ['nue','sol'])]}"/> -->
                            <field name="observaciones" attrs="{'readonly': [('state', 'not in', ['nue','sol'])]}"/>
                            <field name="responsable" attrs="{'readonly': [('state', 'in', ['can','rec'])]}"/>
                        </group>
                        <group>
                            <field name="fecha_sol" attrs="{'readonly': True}"/>
                            <field name="fecha_ult_estado" attrs="{'readonly': True}"/>
                        </group>
                    </group>

                    <!-- context="{'partner_id': docente.id }"-->
                    <notebook position="inside">
                        <page string="Bolsones" attrs="{'invisible': [('mostrar_bolsones','=', False)]}">
                            <field name="bolsones" nolabel="1" widget="one2many_list" mode="tree,kanban"
                                attrs="{'readonly': [('state', 'not in', ['nue','sol'])]}"> 
                                <tree string="bolsones"  editable="bottom">
                                    <field name="solicitud" invisible="1" />
                                    <field name="menor"/>
                                    <field name="nivel"/>
                                    <field name="entregado"/>
                                </tree>
                            </field>
                        </page>

                        <page string="Subsidios" attrs="{'invisible': [('mostrar_subsidios','=', False)]}">
                            <group>
                                <field name="monto_sol" />
                                <field name="monto_aut" attrs="{'readonly': [('state', '!=', 'sol')]}"/>
                                <field name="monto_ren" />
                                <field name="monto_pag" attrs="{'readonly': [('state', '!=', 'aut')]}"/>
                            </group>
                        </page>

                        <page string="Prestamos" attrs="{'invisible': [('mostrar_prestamos','=', False)]}">
                            <p>Por el momento no hay campos definidos para Prestamos</p>
                        </page>

                        <page string="Notas" attrs="{'invisible': [('mostrar_notas','=', False)]}">
                            <field name="notas" widget="html"/>
                        </page>
                    </notebook>
                </sheet>

                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>

            </form>
        </field>
    </record>

    <!-- Envio masivo de mails -->
    <!--  Replace the default mass-mailing wizard in base with the composition wizard -->
    <act_window name="EnvÃ­o masivo de correo"
        res_model="mail.compose.message"
        src_model="docentes.solicitudes"
        view_mode="form"
        multi="True"
        target="new"
        key2="client_action_multi"
        id="action_solicitud_mail_masivo"
        context="{
            'default_composition_mode': 'mass_mail',
            'default_partner_to': '${object.docente.id or \'\'}'
        }"/>

    <record id="email_template_solicitante" model="mail.template">
        <field name="ref_ir_act_window" ref="action_solicitud_mail_masivo"/>
    </record>
    
</odoo>